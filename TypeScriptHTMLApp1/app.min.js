function copyvec2(n){return new vec2(n.x,n.y)}function update(){var n,t;for(drawRect(new vec2(0,0),new vec2(1024,768),"#FFFFFF"),drawText(new vec2(0,750),"Snap: "+(snap?"on":"off")),n=0;n<walls.length;n++)t=walls[n],drawLine(t.a,t.b);snapPosition&&drawRect(new vec2(snapPosition.x-5,snapPosition.y-5),new vec2(snapPosition.x+5,snapPosition.y+5),"#333333",!0)}function drawRect(n,t,i,r){typeof i=="undefined"&&(i="#000000"),typeof r=="undefined"&&(r=!1),ctx.fillStyle=i,r?ctx.strokeRect(n.x,n.y,t.x-n.x,t.y-n.y):ctx.fillRect(n.x,n.y,t.x-n.x,t.y-n.y)}function drawLine(n,t,i,r){typeof i=="undefined"&&(i="#000000"),typeof r=="undefined"&&(r=!1),ctx.beginPath(),ctx.moveTo(n.x,n.y),ctx.lineTo(t.x,t.y),ctx.fillStyle=i,ctx.closePath(),ctx.stroke()}function drawImage(n,t){ctx.drawImage(t,n.x,n.y)}function drawText(n,t,i){typeof i=="undefined"&&(i="#000000"),ctx.fillStyle=i,ctx.font="16px Arial",ctx.fillText(t,n.x,n.y)}var ctx,vec2=function(){function n(n,t){this.x=n,this.y=t}return n.prototype.dist=function(t){var i=new n(t.x-this.x,t.y-this.y);return Math.sqrt(i.x*i.x+i.y*i.y)},n}(),snap=!0,Wall=function(){function n(){this.s=null,this.textureName="",this.portal=null,this.left=null,this.right=null}return n}(),walls=[],Sector=function(){function n(){}return n}(),sectors=[],currentWall,snapPosition;window.onkeydown=function(n){n.keyCode=="S".charCodeAt(0)&&(snap=!snap),n.keyCode==27&&currentWall!=null&&(walls.splice(walls.indexOf(currentWall)),currentWall=null)},currentWall=null,snapPosition=null,window.oncontextmenu=function(n){var t;t=snapPosition!=null?snapPosition:new vec2(n.offsetX,n.offsetY),n.preventDefault(),currentWall!=null&&(currentWall.b=copyvec2(t),currentWall=null),snapPosition!=null||(currentWall=new Wall,currentWall.a=copyvec2(t),currentWall.b=copyvec2(t),walls.push(currentWall))},window.onmousemove=function(n){var i=new vec2(n.offsetX,n.offsetY),t;if(currentWall!=null&&(currentWall.b.x=n.offsetX,currentWall.b.y=n.offsetY),snapPosition=null,snap)for(t=0;t<walls.length;t++)if(walls[t]!=currentWall){if(walls[t].a.dist(i)<5){snapPosition=copyvec2(walls[t].a);break}if(walls[t].b.dist(i)<5){snapPosition=copyvec2(walls[t].b);break}}},window.onload=function(){var t=document.getElementById("content"),n=document.getElementById("canvas");ctx=n.getContext("2d"),setInterval(update,17)}